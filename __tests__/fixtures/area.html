<!doctype html>
<html>
  <head>
    <style>
      html,
      body,
      #container,
      pre,
      .gpt-vis {
        width: 100%;
        height: 100%;
        margin: 0;
      }
      .gpt-vis {
        height: 100% !important;
        width: 100% !important;
        padding: 16px !important;
        box-sizing: border-box;
      }
      .larkmap {
        height: 100% !important;
        width: 100% !important;
      }
      #container {
        box-sizing: border-box;
        padding: 24px;
      }
    </style>
    <script>
      window._AMapSecurityConfig = {
        securityJsCode: '57a0c5ad85f49a7e2f378ce1b890e463',
      };
    </script>
  </head>

  <body>
    <div id="container"></div>

    <script src="https://unpkg.alipay.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.alipay.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://gw.alipayobjects.com/os/lib/lodash/4.17.21/lodash.min.js"></script>
    <script src="../../dist/umd/index.min.js"></script>

    <script>
      // 等待所有依赖加载完成
      window.addEventListener('load', function () {
        try {
          if (typeof React === 'undefined' || typeof ReactDOM === 'undefined') {
            console.error('React 或 ReactDOM 未加载');
            window.chartsLoaded = false;
            return;
          }

          if (typeof GPTVis === 'undefined') {
            console.error('GPTVis 未加载');
            window.chartsLoaded = false;
            return;
          }

          const { createRoot } = ReactDOM;
          const { createElement } = React;

          const container = document.getElementById('container');
          if (!container) {
            console.error('容器元素未找到');
            return;
          }

          const root = createRoot(container);

          const spec = JSON.stringify({
            type: 'area',
            data: [
              { time: '1991', value: 3 },
              { time: '1992', value: 4 },
              { time: '1993', value: 3.5 },
              { time: '1994', value: 5 },
              { time: '1995', value: 4.9 },
              { time: '1996', value: 6 },
              { time: '1997', value: 7 },
              { time: '1998', value: 9 },
              { time: '1999', value: 13 },
            ],
          });
          const markdownContent = `~~~vis-chart\n ${spec} \n~~~`;

          const globalConfig = {
            plot: {
              autoFit: true,
              animate: false,
            },
            graph: {
              autoFit: 'view',
              animation: false,
              padding: 16,
              edge: {
                animation: 'fade',
              },
              layout: {
                animation: false,
              },
            },
            map: {
              token: 'ee17a6f14bd9933d4a25efa0099f7087',
              style: 'amap://styles/2acc71263b1344d93a902db8df1c8b68',
            },
            components: {},
          };

          const Vis = createElement(
            GPTVis.ConfigProvider,
            globalConfig,
            createElement(GPTVis.GPTVis, {}, markdownContent),
          );

          root.render(Vis);

          // 设置加载完成标志
          setTimeout(() => {
            window.chartsLoaded = true;
            console.log('图表加载完成');
          }, 2000);
        } catch (error) {
          console.error('渲染错误:', error);
          window.chartsLoaded = false;
        }
      });
    </script>
  </body>
</html>
