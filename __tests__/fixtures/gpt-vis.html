<!doctype html>
<html>
  <head>
    <style>
      html,
      body,
      #container {
        width: 100%;
        height: 100%;
        margin: 0;
      }
      #container {
        box-sizing: border-box;
        padding: 24px;
      }
    </style>
  </head>

  <body>
    <div id="container"></div>
    <script src="https://gw.alipayobjects.com/os/lib/lodash/4.17.21/lodash.min.js"></script>
    <script src="../../dist/umd/index.min.js"></script>

    <script>
      // 从 URL 参数获取 spec
      function getSpecFromURL() {
        const urlParams = new URLSearchParams(window.location.search);
        const specParam = urlParams.get('spec');

        if (specParam) {
          try {
            return JSON.parse(decodeURIComponent(specParam));
          } catch (error) {
            console.error('解析 URL 参数中的 spec 失败:', error);
          }
        }

        // 默认 spec
        return {
          type: 'area',
          data: [
            { time: '1991', value: 3 },
            { time: '1992', value: 4 },
            { time: '1993', value: 3.5 },
            { time: '1994', value: 5 },
            { time: '1995', value: 4.9 },
            { time: '1996', value: 6 },
            { time: '1997', value: 7 },
            { time: '1998', value: 9 },
            { time: '1999', value: 13 },
          ],
        };
      }

      // 等待所有依赖加载完成
      window.addEventListener('load', function () {
        try {
          if (typeof GPTVis === 'undefined') {
            console.error('GPTVis 未加载');
            window.chartsLoaded = false;
            return;
          }

          const container = document.getElementById('container');
          if (!container) {
            console.error('容器元素未找到');
            return;
          }

          // 使用从 URL 获取的 spec
          const spec = getSpecFromURL();
          const chartType = spec.type;
          const theme = spec.theme || 'default';

          // 创建 GPTVis 实例
          const gptVis = new GPTVis.GPTVis({
            container: container,
            theme: theme,
          });

          // 移除 type 和 theme，传入其他配置
          const { type, ...config } = spec;
          gptVis.render(chartType, config);

          window.chartsLoaded = true;
        } catch (error) {
          console.error('渲染错误:', error);
          window.chartsLoaded = false;
        }
      });
    </script>
  </body>
</html>
